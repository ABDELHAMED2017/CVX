<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>Maximum entropy reconstruction example</title>
      <meta name="generator" content="MATLAB 7.1">
      <meta name="date" content="2006-02-15">
      <meta name="m-file" content="maxent"><style>

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows.  On Gecko-based browsers, the shrink-to-fit doesn't work. */ 
p,h1,h2,div.content div {
  /* for MATLAB's browser */
  width: 600px;
  /* for Mozilla, but the "width" tag overrides it anyway */
  max-width: 600px;
  /* for IE */
  width:expression(document.body.clientWidth > 620 ? "600px": "auto" );
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h1>Maximum entropy reconstruction example</h1><pre class="codeinput"><span class="comment">%</span>
<span class="comment">% distribution of n points, uniform between -1 and 1</span>
<span class="comment">%</span>

n = 100;  a = linspace(-1,1,n)';

<span class="comment">%moment constraints Ax &lt;= b</span>
A = sparse([a'; -a';
   (a.^2)';  -(a.^2)';
   (3*a.^3-2*a)'; -(3*a.^3-2*a)';
   (a&lt;0)';  -(a&lt;0)';
   -eye(n)]);
b = [0.1; 0.1;
      0.6; -0.5;
     -0.2; 0.3;
     0.4; -0.3;
     zeros(n,1)];


<span class="comment">% eliminate last variable</span>
AA = A(:,1:n-1) - A(:,n)*ones(1,n-1);
bb = b - A(:,n);
bb(length(bb)) = 1;


<span class="comment">% maximize and minimize cumsum  up to t, t=1,...,100</span>
Ubnds = zeros(1,n);  Ubnds(n) = 1;
Lbnds = zeros(1,n);  Lbnds(n) = 1;


<span class="keyword">for</span> t=1:(n-1)

   t

   cc = [ones(t,1); zeros(n-t-1,1)];

   <span class="comment">%[z,x,status] = mpc(AA', cc, bb);</span>
   x = linprog(cc,AA,bb);
   Lbnds(t) = cc'*x;

   x = linprog(-cc,AA,bb);
   Ubnds(t) = cc'*x;

<span class="keyword">end</span>



<span class="comment">%</span>
<span class="comment">% max entropy distribution</span>
<span class="comment">%</span>
<span class="comment">% min  sum_i xi*log xi</span>
<span class="comment">% s.t Ax &lt;= b;</span>
<span class="comment">%     1'*x = 1</span>
<span class="comment">%     x &gt;= 0</span>
<span class="comment">%</span>

<span class="comment">%</span>
<span class="comment">% feasibility problem for initial point</span>
<span class="comment">%</span>

cc = [zeros(n-1,1);1];
AA = [AA -ones(size(AA,1),1)];
<span class="comment">%[z,x,status] = mpc(AA', -cc, bb);</span>
xx = linprog(cc,AA,bb);
x = [xx(1:n-1); 1-sum(xx(1:n-1))];

slack = min(b-A*x);
<span class="keyword">if</span> (slack &lt; 0) keyboard; <span class="keyword">end</span>;


MU = 5;
ALPHA = 0.1;
BETA = 0.5;
TOL = 1e-4;
MAXITERS = 50;

m = size(A,1);

t = 1;

<span class="keyword">while</span> ((size(A,1))/t &gt; TOL)

   <span class="keyword">for</span> i=1:MAXITERS

       d = b-A*x;
       val = t*x'*log(x) - sum(log(d));
       g = t*(1+log(x)) + A'*(1./d);
       H = t*diag(1./x) + A'*diag(1./(d.^2))*A;

       sol = [H ones(n,1); ones(1,n) 0] \ [-g; 0];
       v = sol(1:n);
       fprime = g'*v;
       <span class="keyword">if</span> (abs(fprime) &lt; 1e-5) <span class="keyword">break</span>; <span class="keyword">end</span>;

       ntdecr = sqrt(-fprime)

       s = 1;
       newx = x + s*v;
       <span class="keyword">while</span> ((min(newx) &lt; 0)  | (min(b-A*newx) &lt; 0))
           s = s*BETA;
           newx = x + s*v;
       <span class="keyword">end</span>;
       newx = x + s*v;
       newval = t*newx'*log(newx) - sum(log(b-A*newx));
       <span class="keyword">while</span> (newval &gt; val + s*ALPHA*fprime)
           s = s*BETA;
           newx = x + s*v;
           newval = t*newx'*log(newx) - sum(log(b-A*newx));
        <span class="keyword">end</span>;

        x =  x + s*v;

   <span class="keyword">end</span>;

   t = MU*t;

<span class="keyword">end</span>;

figure(1)
xent = x;
stairs(a,cumsum(xent));
grid <span class="string">on</span>;
hold <span class="string">on</span>
d = stairs(a, Lbnds,<span class="string">'r-'</span>);  set(d,<span class="string">'Color'</span>,[0 0.5 0]);
d = stairs(a, Ubnds,<span class="string">'r-'</span>);  set(d,<span class="string">'Color'</span>,[0 0.5 0]);
d = plot([-1,-1], [Lbnds(1), Ubnds(1)],<span class="string">'r-'</span>);
set(d,<span class="string">'Color'</span>,[0 0.5 0]);
axis([-1.1 1.1 -0.1 1.1]);
<span class="comment">%xlabel('x');</span>
ylabel(<span class="string">'y'</span>);
hold <span class="string">off</span>

<span class="comment">%axis([-1 1 0 1.1*max(xent)]);</span>
xlabel(<span class="string">'x'</span>);
ylabel(<span class="string">'y'</span>);
hold <span class="string">off</span>
<span class="comment">% print -deps maxentcumsum.eps</span>


figure(2);
stairs(a,xent);
xlabel(<span class="string">'x'</span>);
ylabel(<span class="string">'y'</span>);
<span class="comment">% print -deps maxentdistr.eps</span>
</pre><pre class="codeoutput">Error using ==&gt; evalin
Undefined command/function 'linprog'.</pre><p class="footer"><br>
            Published with MATLAB&reg; 7.1<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Maximum entropy reconstruction example

%
% distribution of n points, uniform between -1 and 1
%

n = 100;  a = linspace(-1,1,n)';

%moment constraints Ax <= b
A = sparse([a'; -a';
   (a.^2)';  -(a.^2)';
   (3*a.^3-2*a)'; -(3*a.^3-2*a)';
   (a<0)';  -(a<0)';
   -eye(n)]);
b = [0.1; 0.1;
      0.6; -0.5;
     -0.2; 0.3;
     0.4; -0.3;
     zeros(n,1)];


% eliminate last variable
AA = A(:,1:n-1) - A(:,n)*ones(1,n-1);
bb = b - A(:,n);
bb(length(bb)) = 1;


% maximize and minimize cumsum  up to t, t=1,...,100
Ubnds = zeros(1,n);  Ubnds(n) = 1;
Lbnds = zeros(1,n);  Lbnds(n) = 1;


for t=1:(n-1)

   t

   cc = [ones(t,1); zeros(n-t-1,1)];

   %[z,x,status] = mpc(AA', cc, bb);
   x = linprog(cc,AA,bb);
   Lbnds(t) = cc'*x;

   x = linprog(-cc,AA,bb);
   Ubnds(t) = cc'*x;

end



%
% max entropy distribution
%
% min  sum_i xi*log xi
% s.t Ax <= b;
%     1'*x = 1
%     x >= 0
%

%
% feasibility problem for initial point
%

cc = [zeros(n-1,1);1];
AA = [AA -ones(size(AA,1),1)];
%[z,x,status] = mpc(AA', -cc, bb);
xx = linprog(cc,AA,bb);
x = [xx(1:n-1); 1-sum(xx(1:n-1))];

slack = min(b-A*x);
if (slack < 0) keyboard; end;


MU = 5;
ALPHA = 0.1;
BETA = 0.5;
TOL = 1e-4;
MAXITERS = 50;

m = size(A,1);

t = 1;

while ((size(A,1))/t > TOL)

   for i=1:MAXITERS

       d = b-A*x;
       val = t*x'*log(x) - sum(log(d));
       g = t*(1+log(x)) + A'*(1./d);
       H = t*diag(1./x) + A'*diag(1./(d.^2))*A;

       sol = [H ones(n,1); ones(1,n) 0] \ [-g; 0];
       v = sol(1:n);
       fprime = g'*v;
       if (abs(fprime) < 1e-5) break; end;

       ntdecr = sqrt(-fprime)

       s = 1;
       newx = x + s*v;
       while ((min(newx) < 0)  | (min(b-A*newx) < 0))
           s = s*BETA;
           newx = x + s*v;
       end;
       newx = x + s*v;
       newval = t*newx'*log(newx) - sum(log(b-A*newx));
       while (newval > val + s*ALPHA*fprime)
           s = s*BETA;
           newx = x + s*v;
           newval = t*newx'*log(newx) - sum(log(b-A*newx));
        end;

        x =  x + s*v;

   end;

   t = MU*t;

end;

figure(1)
xent = x;
stairs(a,cumsum(xent));
grid on;
hold on
d = stairs(a, Lbnds,'r-');  set(d,'Color',[0 0.5 0]);
d = stairs(a, Ubnds,'r-');  set(d,'Color',[0 0.5 0]);
d = plot([-1,-1], [Lbnds(1), Ubnds(1)],'r-');
set(d,'Color',[0 0.5 0]);
axis([-1.1 1.1 -0.1 1.1]);
%xlabel('x');
ylabel('y');
hold off

%axis([-1 1 0 1.1*max(xent)]);
xlabel('x');
ylabel('y');
hold off
% print -deps maxentcumsum.eps


figure(2);
stairs(a,xent);
xlabel('x');
ylabel('y');
% print -deps maxentdistr.eps

##### SOURCE END #####
-->
   </body>
</html>