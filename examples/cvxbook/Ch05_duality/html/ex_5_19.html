<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>Markovitz portfolio optimization w/ diversification constraint</title>
      <meta name="generator" content="MATLAB 7.2">
      <meta name="date" content="2006-04-01">
      <meta name="m-file" content="ex_5_19"><style>

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows.  On Gecko-based browsers, the shrink-to-fit doesn't work. */ 
p,h1,h2,div.content div {
  /* for MATLAB's browser */
  width: 600px;
  /* for Mozilla, but the "width" tag overrides it anyway */
  max-width: 600px;
  /* for IE */
  width:expression(document.body.clientWidth > 620 ? "600px": "auto" );
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h1>Markovitz portfolio optimization w/ diversification constraint</h1><pre class="codeinput"><span class="comment">% Exercise 5.19 c), Boyd &amp; Vandenberghe "Convex Optimization"</span>
<span class="comment">% Jo&euml;lle Skaf - 08/29/05</span>
<span class="comment">%</span>
<span class="comment">% Solves an extension of the classical Markovitz portfolio optimization</span>
<span class="comment">% problem:      minimize    x'Sx</span>
<span class="comment">%                   s.t.    p_'*x &gt;= r_min</span>
<span class="comment">%                           1'*x = 1,   x &gt;= 0</span>
<span class="comment">%                           sum_{i=1}^{0.1*n}x[i] &lt;= alpha</span>
<span class="comment">% where p_ and S are the mean and covariance matrix of the price range</span>
<span class="comment">% vector p, x[i] is the ith greatest component in x.</span>
<span class="comment">% The last constraint can be replaced by this equivalent set of constraints</span>
<span class="comment">%                           r*t + sum(u) &lt;= alpha</span>
<span class="comment">%                           t*1 + u &gt;= x</span>
<span class="comment">%                           u &gt;= 0</span>

<span class="comment">% Input data</span>
randn(<span class="string">'state'</span>,0);
n = 25;
p_mean = randn(n,1);
temp = randn(n);
sig = temp'*temp;
r = floor(0.1*n);
alpha = 0.8;
r_min = 1;

<span class="comment">% original formulation</span>
fprintf(1,<span class="string">'Computing the optimal Markovitz portfolio: \n'</span>);
fprintf(1,<span class="string">'# using the original formulation ... '</span>);

cvx_begin
    variable <span class="string">x1(n)</span>
    minimize ( quad_form(x1,sig) )
    p_mean'*x1 &gt;= r_min;
    ones(1,n)*x1 == 1;
    x1 &gt;= 0;
    sum_largest(x1,r) &lt;= alpha;
cvx_end

fprintf(1,<span class="string">'Done! \n'</span>);
opt1 = cvx_optval;

<span class="comment">% equivalent formulation</span>
fprintf(1,<span class="string">'# using an equivalent formulation by replacing the diversification\n'</span>);
fprintf(1,<span class="string">'  constraint by an equivalent set of linear constraints...'</span>);

cvx_begin
    variables <span class="string">x2(n)</span> <span class="string">u(n)</span> <span class="string">t(1)</span>
    minimize ( quad_form(x2,sig) )
    p_mean'*x2 &gt;= r_min;
    sum(x2) == 1;
    x2 &gt;= 0;
    r*t + sum(u) &lt;= alpha;
    t*ones(n,1) + u &gt;= x2;
    u &gt;= 0;
cvx_end

fprintf(1,<span class="string">'Done! \n'</span>);
opt2 = cvx_optval;

<span class="comment">% Displaying results</span>
disp(<span class="string">'------------------------------------------------------------------------'</span>);
disp(<span class="string">'The optimal portfolios obtained from the original problem formulation and'</span>);
disp(<span class="string">'from the equivalent formulation are respectively: '</span>);
disp([x1 x2])
disp(<span class="string">'They are equal as expected!'</span>);
</pre><pre class="codeoutput">Computing the optimal Markovitz portfolio: 
# using the original formulation ...  
Calling SeDuMi: 104 variables (1 free), 54 equality constraints
------------------------------------------------------------------------
SeDuMi 1.1 by AdvOL, 2005 and Jos F. Sturm, 1998, 2001-2003.
Alg = 2: xz-corrector, Adaptive Step-Differentiation, theta = 0.250, beta = 0.500
Split 1 free variables
eqs m = 54, order n = 81, dim = 106, blocks = 2
nnz(A) = 855 + 0, nnz(ADA) = 2806, nnz(L) = 1430
 it :     b*y       gap    delta  rate   t/tP*  t/tD*   feas cg cg  prec
  0 :            1.04E+001 0.000
  1 : -7.01E-001 3.91E+000 0.000 0.3765 0.9000 0.9000   2.34  1  1  1.1E+001
  2 : -1.96E-003 2.05E+000 0.000 0.5250 0.9000 0.9000   3.37  1  1  2.9E+000
  3 :  2.64E-001 9.18E-001 0.000 0.4468 0.9000 0.9000   1.52  1  1  1.1E+000
  4 :  3.95E-001 5.34E-001 0.000 0.5822 0.9000 0.9000   1.00  1  1  6.7E-001
  5 :  5.36E-001 2.76E-001 0.000 0.5167 0.9000 0.9000   1.10  1  1  3.4E-001
  6 :  6.11E-001 1.55E-001 0.000 0.5627 0.9000 0.9000   0.89  1  1  2.0E-001
  7 :  7.06E-001 4.61E-002 0.000 0.2968 0.9000 0.9000   1.14  1  1  5.5E-002
  8 :  7.37E-001 1.35E-002 0.000 0.2922 0.9000 0.9000   0.95  1  1  1.7E-002
  9 :  7.50E-001 8.62E-005 0.000 0.0064 0.9990 0.9990   1.02  1  1  1.1E-004
 10 :  7.50E-001 1.80E-005 0.000 0.2089 0.9000 0.8890   1.00  1  1  2.4E-005
 11 :  7.50E-001 3.79E-006 0.000 0.2108 0.9033 0.9000   1.00  1  1  4.7E-006
 12 :  7.50E-001 8.49E-007 0.000 0.2237 0.9098 0.9000   1.00  1  1  8.4E-007
 13 :  7.50E-001 2.45E-007 0.232 0.2881 0.9140 0.9000   1.00  1  1  1.9E-007
 14 :  7.50E-001 7.64E-008 0.132 0.3125 0.9161 0.9000   1.00  2  2  4.9E-008
 15 :  7.50E-001 1.24E-008 0.000 0.1626 0.9000 0.9049   1.00  2  2  8.7E-009

iter seconds digits       c*x               b*y
 15      0.3   7.9  7.5016966061e-001  7.5016965006e-001
|Ax-b| =  7.5e-009, [Ay-c]_+ =  3.7E-010, |x|= 1.7e+000, |y|= 3.0e+000

Detailed timing (sec)
   Pre          IPM          Post
1.001E-002    2.604E-001    0.000E+000    
Max-norms: ||b||=1, ||c|| = 1,
Cholesky |add|=0, |skip| = 0, ||L.L|| = 20.1447.
------------------------------------------------------------------------
Status: Solved
Optimal value (cvx_optval): +0.75017
Done! 
# using an equivalent formulation by replacing the diversification
  constraint by an equivalent set of linear constraints... 
Calling SeDuMi: 105 variables (1 free), 54 equality constraints
------------------------------------------------------------------------
SeDuMi 1.1 by AdvOL, 2005 and Jos F. Sturm, 1998, 2001-2003.
Alg = 2: xz-corrector, Adaptive Step-Differentiation, theta = 0.250, beta = 0.500
Split 1 free variables
eqs m = 54, order n = 82, dim = 107, blocks = 2
nnz(A) = 881 + 0, nnz(ADA) = 2860, nnz(L) = 1457
 it :     b*y       gap    delta  rate   t/tP*  t/tD*   feas cg cg  prec
  0 :            3.69E+001 0.000
  1 : -7.01E-001 1.39E+001 0.000 0.3759 0.9000 0.9000   2.34  1  1  2.1E+001
  2 : -2.24E-003 7.28E+000 0.000 0.5247 0.9000 0.9000   3.37  1  1  5.5E+000
  3 :  2.64E-001 3.26E+000 0.000 0.4480 0.9000 0.9000   1.53  1  1  2.1E+000
  4 :  3.94E-001 1.91E+000 0.000 0.5842 0.9000 0.9000   1.01  1  1  1.3E+000
  5 :  5.35E-001 9.90E-001 0.000 0.5199 0.9000 0.9000   1.11  1  1  6.7E-001
  6 :  6.10E-001 5.61E-001 0.000 0.5660 0.9000 0.9000   0.90  1  1  4.0E-001
  7 :  7.06E-001 1.68E-001 0.000 0.2998 0.9000 0.9000   1.15  1  1  1.1E-001
  8 :  7.36E-001 4.97E-002 0.000 0.2959 0.9000 0.9000   0.95  1  1  3.4E-002
  9 :  7.50E-001 3.20E-004 0.000 0.0064 0.9990 0.9990   1.02  1  1  2.1E-004
 10 :  7.50E-001 7.21E-005 0.000 0.2255 0.9000 0.8878   1.00  1  1  4.7E-005
 11 :  7.50E-001 1.39E-005 0.000 0.1935 0.9021 0.9000   1.00  1  1  9.3E-006
 12 :  7.50E-001 2.49E-006 0.000 0.1784 0.9083 0.9000   1.00  1  1  1.7E-006
 13 :  7.50E-001 5.45E-007 0.205 0.2190 0.9141 0.9000   1.00  1  1  3.7E-007
 14 :  7.50E-001 1.35E-007 0.050 0.2479 0.9117 0.9000   1.00  2  1  8.8E-008
 15 :  7.50E-001 2.64E-008 0.000 0.1954 0.9000 0.9080   1.00  2  2  1.8E-008
 16 :  7.50E-001 5.22E-009 0.000 0.1978 0.9000 0.9015   1.00  2  2  3.5E-009

iter seconds digits       c*x               b*y
 16      0.3   8.7  7.5016966175e-001  7.5016966037e-001
|Ax-b| =  3.4e-009, [Ay-c]_+ =  6.4E-011, |x|= 1.7e+000, |y|= 3.0e+000

Detailed timing (sec)
   Pre          IPM          Post
1.001E-002    2.504E-001    0.000E+000    
Max-norms: ||b||=1, ||c|| = 1,
Cholesky |add|=0, |skip| = 0, ||L.L|| = 19.7457.
------------------------------------------------------------------------
Status: Solved
Optimal value (cvx_optval): +0.75017
Done! 
------------------------------------------------------------------------
The optimal portfolios obtained from the original problem formulation and
from the equivalent formulation are respectively: 
    0.0000    0.0000
    0.0000    0.0000
    0.1342    0.1342
    0.0000    0.0000
    0.0000    0.0000
    0.1177    0.1177
    0.1134    0.1134
    0.0123    0.0123
    0.0904    0.0904
    0.0256    0.0256
    0.0451    0.0451
    0.0437    0.0437
    0.0000    0.0000
    0.1435    0.1435
    0.0000    0.0000
    0.0086    0.0086
    0.1177    0.1177
    0.0000    0.0000
    0.0000    0.0000
    0.0000    0.0000
    0.0000    0.0000
    0.0000    0.0000
    0.0313    0.0313
    0.1164    0.1164
    0.0000    0.0000

They are equal as expected!
</pre><p class="footer"><br>
            Published with MATLAB&reg; 7.2<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Markovitz portfolio optimization w/ diversification constraint

% Exercise 5.19 c), Boyd & Vandenberghe "Convex Optimization"
% Joëlle Skaf - 08/29/05
% 
% Solves an extension of the classical Markovitz portfolio optimization
% problem:      minimize    x'Sx 
%                   s.t.    p_'*x >= r_min
%                           1'*x = 1,   x >= 0
%                           sum_{i=1}^{0.1*n}x[i] <= alpha
% where p_ and S are the mean and covariance matrix of the price range
% vector p, x[i] is the ith greatest component in x. 
% The last constraint can be replaced by this equivalent set of constraints
%                           r*t + sum(u) <= alpha
%                           t*1 + u >= x
%                           u >= 0

% Input data
randn('state',0);
n = 25;
p_mean = randn(n,1);
temp = randn(n);
sig = temp'*temp;
r = floor(0.1*n);
alpha = 0.8;
r_min = 1;

% original formulation
fprintf(1,'Computing the optimal Markovitz portfolio: \n');
fprintf(1,'# using the original formulation ... ');

cvx_begin
    variable x1(n) 
    minimize ( quad_form(x1,sig) ) 
    p_mean'*x1 >= r_min;
    ones(1,n)*x1 == 1;
    x1 >= 0;
    sum_largest(x1,r) <= alpha;
cvx_end

fprintf(1,'Done! \n');
opt1 = cvx_optval;

% equivalent formulation
fprintf(1,'# using an equivalent formulation by replacing the diversification\n');
fprintf(1,'  constraint by an equivalent set of linear constraints...');

cvx_begin
    variables x2(n) u(n) t(1) 
    minimize ( quad_form(x2,sig) ) 
    p_mean'*x2 >= r_min;
    sum(x2) == 1;
    x2 >= 0;
    r*t + sum(u) <= alpha;
    t*ones(n,1) + u >= x2;
    u >= 0;
cvx_end

fprintf(1,'Done! \n');
opt2 = cvx_optval;

% Displaying results
disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
disp('The optimal portfolios obtained from the original problem formulation and');
disp('from the equivalent formulation are respectively: ');
disp([x1 x2])
disp('They are equal as expected!');

##### SOURCE END #####
-->
   </body>
</html>